{% extends 'places/base.html' %}

{% load static %}
{% load martortags %}

{% block title %}
  {{ place.title }} - Welp
{% endblock %}

{% block content %}
    <article class="place-detail">
        
        <header class="place-detail__header">
            <h2 class="place-detail__title">{{ place.title }}</h2>
            <div class="place-detail__address">{{ place.current_address|default:"" }}</div>
            <div class="place-detail__categories">
                {% for category in place.categories.all %}
                    <div class="place-detail__category category-{{ category.slug }}">
                        <a href="{% url 'places:category' category.slug %}">{{ category.name }}</a>
                    </div>
                {% endfor %}
            </div>
            
        </header>
        
        {% if place.images %}
            {% if place.displays_images_extended %} 
                <div class="place-detail__images place-detail__images--extended">
                    {% for image in place.images.all %}
                        <div class="place-detail__cell {{image.classes}}">
                            <img class="place-detail__image" data-flickity-lazyload-srcset="{{ image.safe_large.url }} {{image.safe_large.width}}w, {{ image.safe_medium.url }} {{image.safe_medium.width}}w"
                                data-flickity-lazyload-src="{{ image.safe_large.url }}"
                                alt="{{ image.alt }}"
                                width="{{ image.safe_large.width }}"
                                height="{{ image.safe_large.height }}"
                                />
                            <footer>
                                <div class="place-detail__image__attribution">
                                  {{ image.attribution }}
                                </div>
                            </header>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="place-detail__images">
                    {% for image in place.images.all %}
                        <div class="place-detail__cell {{image.classes}}">
                            <img class="place-detail__image" 
                                srcset="{{ image.safe_large.url }} {{image.safe_large.width}}w, {{ image.safe_medium.url }} {{image.safe_medium.width}}w"
                                src="{{ image.safe_large.url }}"
                                alt="{{ image.alt }}"
                                width="{{ image.safe_large.width }}"
                                height="{{ image.safe_large.height }}"
                                />
                            <footer>
                                <div class="place-detail__image__attribution">
                                  {{ image.attribution }}
                                </div>
                            </header>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}       
        {% endif %}
            
        <div class="place-detail__description">
            {{ place.description|safe_markdown }}
        </div>
        
        <footer class="place-detail__sidebar">
            
            <div class="place-detail__location">
                <div class="map">
                    <div id="map__container" class="map__container" 
                        data-place-id={{ place.id }}
                        data-zoom=14
                        data-lat={{ place.location.x }}
                        data-lng={{ place.location.y }}></div>
                </div>
            </div>
            
            {% if place.previous_addresses %} 
            <div class="place-detail__meta">
                <h3 class="place-detail__meta__title">Previous Addresses</h3>
                <ul>
                {% for address in place.previous_addresses %}
                    <li>{{ address.address }}</li>  
                {% endfor %}
                </ul>  
            </div>
            {% endif %}
            
            {% if place.nearby %} 
            <div class="place-detail__meta place-detail__related-places">
                <h3 class="place-detail__meta__title">Nearby</h3>
                {% for nearby_place in place.nearby %}
                    <div class="related-place">
                        <h4 class="related-place__title"><a href="{% url 'places:detail' nearby_place.id %}">{{ nearby_place.title }}</a></h4>
                        <div class="related-place__address"></div>
                    </div>  
                {% endfor %}  
            </div>
            {% endif %} 
            
            
        </footer>
        
    </article>
{% endblock %}