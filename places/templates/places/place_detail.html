{% extends 'places/base.html' %}

{% load static %}
{% load martortags %}
{% load comments %}

{% block title %}
  {{ place.title }} - Welp
{% endblock %}

{% block head %}
<meta property="og:title" content="{{ place.title }}">
<meta property="og:description" content="">
{% with place.images.all|first as image %}
{% if image %}
	<meta property="og:image" content="{{ image.safe_large.url }}">
	<meta name="twitter:image:alt" content="{{ image.alt }}">
{% endif %}
{% endwith %}
<meta property="og:url" content="https://{{ request.get_host }}{{ place.get_absolute_url }}">
<meta name="twitter:card" content="summary_large_image">
<meta property="og:site_name" content="Welp">
{% endblock %}

{% block content %}
    <article class="place-detail">
        
        <header class="place-detail__header">
            <h2 class="place-detail__title">{{ place.title }}</h2>
            <div class="place-detail__address">{{ place.current_address|default:"" }}</div>
            <div class="place-detail__categories">
                {% for category in place.categories.all %}
                    <div class="place-detail__category category-{{ category.slug }}">
                        <a href="{% url 'places:category' category.slug %}">{{ category.name }}</a>
                    </div>
                {% endfor %}
            </div>
            
            {% if user.is_authenticated %}
            <div class="edit-links">
                <a href="{% url 'admin:places_place_change' place.id %}">Edit</a>
            </div>
            {% endif %}
            
        </header>
        
        {% if place.images %}
            {% if place.displays_images_extended %} 
                <div class="place-detail__images place-detail__images--extended">
                    {% for image in place.images.all %}
                        <figure class="place-detail__cell {{image.classes}}">
                            <img class="place-detail__image" 
                                data-flickity-lazyload-src="{{ image.safe_large.url }}"
                                alt="{{ image.alt }}"
                                />
                             <figcaption class="place-detail__image__caption">
                                <h3 class="place-detail__image__title">{{ image.title }}</h3>
								<div class="place-detail__image__description">{{ image.description|safe_markdown }}</div>
                            </figcaption>
                            <footer>
                                <div class="place-detail__image__attribution">
                                  {{ image.attribution }}
                                </div>
                            </header>
                        </figure>
                    {% endfor %}
                </div>
            {% else %}
                <div class="place-detail__images">
                    {% for image in place.images.all %}
                        <figure class="place-detail__cell {{image.classes}}">
                            <img class="place-detail__image" 
                                src="{{ image.safe_large.url }}"
                                alt="{{ image.alt }}"
                                />
                             <figcaption class="place-detail__image__caption">
                                <h3 class="place-detail__image__title">{{ image.title }}</h3>
								<div class="place-detail__image__description">{{ image.description }}</div>
                            </figcaption>
                            <footer class="place-detail__image__footer">
                                <div class="place-detail__image__attribution">
                                  {{ image.attribution }}
                                </div>
                            </header>
                        </figure>
                    {% endfor %}
                </div>
            {% endif %}       
        {% endif %}
            
        <div class="place-detail__description">
            {{ place.description|safe_markdown }}
        </div>
        
        {% if place.chain and place.chain.description %} 
        <div class="place-detail__description place-detail__description--chain">
            <h2 class="place-detail__chain-title"><a href="{% url 'places:chain' place.chain.id %}">{{ place.chain.title }}</a></h2>
            {{ place.chain.description|safe_markdown }}
        </div>
        {% endif %}
        
        <div class="place-detail__comments">
            {% render_comment_list for place %}
            {% render_comment_form for place %}
        </div>
        
        <footer class="place-detail__sidebar">
            
            <div class="place-detail__meta place-detail__location">
                <div class="map">
                    <div id="map__container" class="map__container" 
                        data-place-id={{ place.id }}
                        data-building-id={{ place.building.id }}
                        data-zoom=14
                        data-lat={{ place.location.x }}
                        data-lng={{ place.location.y }}></div>
                </div>
            </div>
            
            {% if place.aliases %} 
            <div class="place-detail__meta">
                <h3 class="place-detail__meta__title">Also Known As</h3>
                <div class="place-detail__meta__description">{{ place.aliases|safe_markdown }}</div>
            </div>
            {% endif %}
            
            {% if place.previous_addresses %} 
            <div class="place-detail__meta">
                <h3 class="place-detail__meta__title">Previous Addresses</h3>
                <ul>
                {% for address in place.previous_addresses %}
                    <li>{{ address.address }}</li>  
                {% endfor %}
                </ul>  
            </div>
            {% endif %}
            
            {% if other_building_locations %} 
            <div class="place-detail__meta place-detail__related-places">
                <h3 class="place-detail__meta__title">
                    <a href="{% url 'places:building' place.building.id %}">Also at {{ place.building }}</a>
                </h3>
                {% for related_place in other_building_locations %}
                    <div class="related-place">
                        <h4 class="related-place__title"><a href="{% url 'places:detail' related_place.id %}">{{ related_place.title }}</a></h4>
                        <div class="related-place__address">{{ related_place.current_address|default:"" }}</div>
                    </div>  
                {% endfor %}  
            </div>
            {% endif %}
            
            
            {% if nearby %} 
            <div class="place-detail__meta place-detail__related-places">
                <h3 class="place-detail__meta__title">Nearby</h3>
                {% for related_place in nearby %}
                    <div class="related-place">
                        <h4 class="related-place__title"><a href="{% url 'places:detail' related_place.id %}">{{ related_place.title }}</a></h4>
                        <div class="related-place__address">{{ related_place.current_address.address }}</div>
                    </div>  
                {% endfor %}  
            </div>
            {% endif %}
            
            {% if other_chain_locations %} 
            <div class="place-detail__meta place-detail__related-places">
                <h3 class="place-detail__meta__title">
                    <a href="{% url 'places:chain' place.chain.id %}">{{ place.chain }} Locations</a>
                </h3>
                {% for related_place in other_chain_locations %}
                    <div class="related-place">
                        <h4 class="related-place__title"><a href="{% url 'places:detail' related_place.id %}">{{ related_place.title }}</a></h4>
                        <div class="related-place__address">{{ related_place.current_address|default:"" }}</div>
                    </div>  
                {% endfor %}  
            </div>
            {% endif %}
            

            
        </footer>
        
    </article>
{% endblock %}